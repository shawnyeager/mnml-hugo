{{- $url := .Destination -}}
{{- $text := .Text -}}
{{- $title := .Title -}}

{{- /* Handle video links */ -}}
{{- if or (strings.HasSuffix $url ".mp4") (strings.HasSuffix $url ".mov") (strings.HasSuffix $url ".webm") -}}
{{- .Page.Store.Set "hasVideo" true -}}
</p>
{{- /* Add leading slash if URL doesn't start with /, http://, or https:// */ -}}
{{- $videoUrl := $url -}}
{{- if and (not (hasPrefix $url "/")) (not (hasPrefix $url "http://")) (not (hasPrefix $url "https://")) -}}
  {{- $videoUrl = printf "/%s" $url -}}
{{- end -}}
<video controls preload="metadata"{{- if $text }} aria-label="{{ $text }}"{{- end }}{{- if $title }} poster="{{ $title }}"{{- end }}>
  <source src="{{ $videoUrl }}" type="video/{{ path.Ext $url | strings.TrimPrefix "." }}">
  {{- if $text }}
  {{ $text }}
  {{- end }}
</video>
<p>
{{- /* Handle Obsidian-style .md links (convert to Hugo relref) */ -}}
{{- else if strings.HasSuffix $url ".md" -}}
{{- $cleanUrl := strings.TrimSuffix $url ".md" -}}
{{- with .Page.GetPage $cleanUrl -}}
<a href="{{ .RelPermalink }}"{{- with $title }} title="{{ . }}"{{- end }}>{{ $text | safeHTML }}</a>
{{- else -}}
<a href="{{ $url }}"{{- with $title }} title="{{ . }}"{{- end }}>{{ $text | safeHTML }}</a>
{{- end -}}
{{- /* Regular links */ -}}
{{- else -}}
<a href="{{ $url }}"{{- with $title }} title="{{ . }}"{{- end }}>{{ $text | safeHTML }}</a>
{{- end -}}
